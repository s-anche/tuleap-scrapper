import{d as M,r as T,k as A,o as F,g as s,I as u,y as a,C as t,B as o,D as f,x as g,J as v,z as d,A as p,M as D,N as R,S as c,T as K,u as Q}from"./CTSJwtqj.js";import{_ as H}from"./DlAUqK2U.js";const X={key:0,class:"text-center py-8"},Y={key:2},Z={class:"d-flex align-center ga-2"},ee={class:"d-flex align-center ga-2"},te={key:3,class:"text-center py-8"},ae=M({__name:"EpicTreeView",props:{epic:{}},setup(j){const k=j,U=T(!0),n=T(null),h=T([]),E=T(["epic"]),N=A(()=>{const i=r=>({...r,children:r.children?L(r.children).map(i):[]});return h.value.map(r=>({...r,children:r.children?L(r.children).map(i):[]}))}),P=async()=>{try{U.value=!0,n.value=null;const i=await c.getEpicTreeData(k.epic),r={id:"epic",title:k.epic.title,type:"epic",status:k.epic.status,points:k.epic.estimation,remainingEffort:k.epic.remainingEffort,htmlUrl:k.epic.htmlUrl,children:[]};for(const e of i.features){const y={id:`feature-${e.artifact.id}`,title:e.artifact.title,type:"feature",artifact:e.artifact,status:e.artifact.status,points:e.points,remainingEffort:e.remainingEffort,linkedArtifactCount:e.linkedArtifactCount,percentWithPoints:e.percentWithPoints,htmlUrl:c.buildTuleapUrl(e.artifact.html_url,e.artifact.id),children:[]};for(const m of e.subArtifacts){const I={id:`sub-${m.id}`,title:m.title,type:m.tracker.label.toLowerCase().includes("task")?"task":"story",artifact:m,status:m.status,points:c.extractPoints(m),remainingEffort:c.extractRemainingEffort(m),sprint:await c.extractSprintInfo(m),htmlUrl:c.buildTuleapUrl(m.html_url,m.id)};y.children.push(I)}r.children.push(y)}for(const e of i.directStories){const y={id:`story-${e.id}`,title:e.title,type:"story",artifact:e,status:e.status,points:c.extractPoints(e),remainingEffort:c.extractRemainingEffort(e),sprint:await c.extractSprintInfo(e),htmlUrl:c.buildTuleapUrl(e.html_url,e.id)};r.children.push(y)}for(const e of i.directTasks){const y={id:`task-${e.id}`,title:e.title,type:"task",artifact:e,status:e.status,points:c.extractPoints(e),remainingEffort:c.extractRemainingEffort(e),sprint:await c.extractSprintInfo(e),htmlUrl:c.buildTuleapUrl(e.html_url,e.id)};r.children.push(y)}for(const e of i.defects){const y={id:`defect-${e.id}`,title:e.title,type:"defect",artifact:e,status:e.status,points:c.extractPoints(e),remainingEffort:c.extractRemainingEffort(e),sprint:await c.extractSprintInfo(e),htmlUrl:c.buildTuleapUrl(e.html_url,e.id)};r.children.push(y)}h.value=[r],E.value=["epic",...r.children.map(e=>e.id)]}catch(i){n.value=i.message||"Failed to load tree data",console.error("Error loading tree data:",i)}finally{U.value=!1}},C=i=>{switch(i){case"epic":return"mdi-mountain";case"feature":return"mdi-puzzle-outline";case"story":return"mdi-book-open-variant";case"task":return"mdi-clipboard-list";case"defect":return"mdi-bug";default:return"mdi-file-document"}},b=i=>{switch(i){case"epic":return"purple";case"feature":return"primary";case"story":return"success";case"task":return"info";case"defect":return"error";default:return"grey"}},_=i=>{switch(i?.toLowerCase()){case"done":return"success";case"development in progress":return"warning";case"implementation in progress":return"warning";case"implemented":return"primary";case"to do":return"info";case"new":return"info";case"ready":return"info";case"cancelled":return"error";case"merged":return"success";case"done without dev":return"success";default:return"grey"}},z=i=>{switch(i?.toLowerCase()){case"new":return 1;case"to do":return 2;case"ready":return 3;case"implementation in progress":return 4;case"development in progress":return 4;case"implemented":return 5;case"done":return 6;case"done without dev":return 6;case"merged":return 6;case"cancelled":return 7;default:return 8}},L=i=>[...i].sort((r,e)=>{const y=z(r.status||""),m=z(e.status||"");return y-m});return F(()=>{P()}),(i,r)=>{const e=s("v-icon"),y=s("v-card-title"),m=s("v-progress-circular"),I=s("v-alert"),w=s("v-chip"),S=s("v-list-item-title"),$=s("v-list-item"),V=s("v-list"),W=s("v-expansion-panel-text"),J=s("v-expansion-panel"),O=s("v-expansion-panels"),q=s("v-card-text"),G=s("v-card");return a(),u(G,{elevation:"2"},{default:t(()=>[o(y,{class:"d-flex align-center"},{default:t(()=>[o(e,{icon:C("epic"),color:b("epic"),class:"mr-2"},null,8,["icon","color"]),r[0]||(r[0]=f(" Epic Artifacts Tree "))]),_:1,__:[0]}),o(q,null,{default:t(()=>[U.value?(a(),g("div",X,[o(m,{indeterminate:"",size:"48",color:"primary"}),r[1]||(r[1]=d("div",{class:"mt-4"},"Loading epic tree data...",-1))])):n.value?(a(),u(I,{key:1,type:"error",variant:"tonal",class:"mb-4"},{default:t(()=>[f(p(n.value),1)]),_:1})):(a(),g("div",Y,[d("div",null,[r[2]||(r[2]=d("h4",null,"Epic Artifacts Tree:",-1)),o(O,{multiple:"",variant:"accordion"},{default:t(()=>[(a(!0),g(D,null,R(N.value,B=>(a(),u(J,{key:B.id,title:B.title},{default:t(()=>[o(W,null,{default:t(()=>[B.children&&B.children.length>0?(a(),u(V,{key:0},{default:t(()=>[(a(!0),g(D,null,R(B.children,l=>(a(),g(D,{key:l.id},[l.type==="feature"?(a(),u($,{key:0,"prepend-icon":C(l.type),href:l.htmlUrl,target:"_blank",class:"feature-item"},{append:t(()=>[l.status?(a(),u(w,{key:0,color:_(l.status),size:"x-small",variant:"tonal"},{default:t(()=>[f(p(l.status),1)]),_:2},1032,["color"])):v("",!0)]),default:t(()=>[o(S,{class:"font-weight-medium"},{default:t(()=>[f(p(l.title)+" ",1),l.linkedArtifactCount?(a(),u(w,{key:0,size:"x-small",variant:"tonal",color:"info",class:"ml-2"},{default:t(()=>[f(p(l.linkedArtifactCount)+" items ",1)]),_:2},1024)):v("",!0)]),_:2},1024)]),_:2},1032,["prepend-icon","href"])):v("",!0),l.children&&l.children.length>0?(a(),u(V,{key:1,class:"ml-8"},{default:t(()=>[(a(!0),g(D,null,R(l.children,x=>(a(),u($,{key:x.id,"prepend-icon":C(x.type),href:x.htmlUrl,target:"_blank",class:"sub-artifact-item",density:"compact"},{append:t(()=>[d("div",Z,[x.points?(a(),u(w,{key:0,size:"x-small",variant:"tonal",color:"primary"},{default:t(()=>[f(p(x.points)+"pts ",1)]),_:2},1024)):v("",!0),x.status?(a(),u(w,{key:1,color:_(x.status),size:"x-small",variant:"tonal"},{default:t(()=>[f(p(x.status),1)]),_:2},1032,["color"])):v("",!0)])]),default:t(()=>[o(S,{class:"text-body-2"},{default:t(()=>[f(p(x.title),1)]),_:2},1024)]),_:2},1032,["prepend-icon","href"]))),128))]),_:2},1024)):v("",!0),l.type!=="feature"?(a(),u($,{key:2,"prepend-icon":C(l.type),href:l.htmlUrl,target:"_blank",class:"direct-item"},{append:t(()=>[d("div",ee,[l.points?(a(),u(w,{key:0,size:"x-small",variant:"tonal",color:"primary"},{default:t(()=>[f(p(l.points)+"pts ",1)]),_:2},1024)):v("",!0),l.status?(a(),u(w,{key:1,color:_(l.status),size:"x-small",variant:"tonal"},{default:t(()=>[f(p(l.status),1)]),_:2},1032,["color"])):v("",!0)])]),default:t(()=>[o(S,null,{default:t(()=>[f(p(l.title),1)]),_:2},1024)]),_:2},1032,["prepend-icon","href"])):v("",!0)],64))),128))]),_:2},1024)):v("",!0)]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1})])])),!U.value&&!n.value&&h.value.length===0?(a(),g("div",te,[o(e,{icon:"mdi-file-tree-outline",size:"64",color:"grey"}),r[3]||(r[3]=d("div",{class:"mt-4 text-h6"},"No artifacts found",-1)),r[4]||(r[4]=d("div",{class:"text-body-2 text-grey"},"This epic has no linked artifacts.",-1))])):v("",!0)]),_:1})]),_:1})}}}),re=Object.assign(H(ae,[["__scopeId","data-v-70eb07ab"]]),{__name:"EpicTreeView"}),ne={class:"d-flex align-center mb-4"},se={key:0,class:"text-center py-8"},oe={class:"d-flex align-center flex-grow-1"},ie={class:"text-h4"},le={class:"text-subtitle-1 text-grey-darken-1 mt-1"},ce={key:0,class:"text-h4 ml-4"},ue={key:1,class:"text-grey-darken-1"},de={class:"d-flex gap-2"},pe={key:0,class:"mb-4"},_e=["innerHTML"],me=M({__name:"[id]",setup(j){const k=K(),U=Q(),n=T(null),h=T(!0),E=T(null),N=A(()=>{const b=k.params.id;return typeof b=="string"?parseInt(b):null}),P=async()=>{if(!N.value){E.value="Invalid epic ID",h.value=!1;return}try{h.value=!0,E.value=null,n.value=await c.getEpicById(N.value)}catch(b){E.value=b.message||"Failed to load epic",console.error("Error loading epic:",b)}finally{h.value=!1}},C=()=>{U.back()};return F(()=>{P()}),(b,_)=>{const z=s("v-btn"),L=s("v-breadcrumbs"),i=s("v-progress-circular"),r=s("v-alert"),e=s("v-chip"),y=s("v-card-title"),m=s("v-col"),I=s("v-row"),w=s("v-divider"),S=s("v-card-text"),$=s("v-card"),V=s("v-container");return a(),u(V,{fluid:"",class:"pa-4"},{default:t(()=>[d("div",ne,[o(z,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:C,class:"mr-3"},{default:t(()=>_[0]||(_[0]=[f(" Back ")])),_:1,__:[0]}),o(L,{items:[{title:"Home",disabled:!1,to:"/"},{title:`Epic #${N.value}`,disabled:!0}],class:"pa-0"},null,8,["items"])]),h.value?(a(),g("div",se,[o(i,{indeterminate:"",size:"64",color:"primary"}),_[1]||(_[1]=d("div",{class:"mt-4 text-h6"},"Loading epic details...",-1))])):E.value?(a(),u(r,{key:1,type:"error",variant:"tonal",closable:"",class:"mb-4"},{default:t(()=>[f(p(E.value),1)]),_:1})):n.value?(a(),g(D,{key:2},[o($,{class:"mb-6",elevation:"2"},{default:t(()=>[o(y,{class:"d-flex align-center pa-6"},{default:t(()=>[d("div",oe,[o(e,{class:"mr-3",variant:"flat",size:"default",color:n.value.status==="Done"?"success":n.value.status==="Development in progress"?"warning":"info"},{default:t(()=>[f(p(n.value.status),1)]),_:1},8,["color"]),d("div",null,[d("div",ie,p(n.value.title),1),d("div",le,p(n.value.project.label)+" â€¢ Epic #"+p(n.value.id),1)])]),n.value.project.icon?(a(),g("div",ce,p(n.value.project.icon),1)):v("",!0)]),_:1}),o(S,{class:"pa-6 pt-0"},{default:t(()=>[o(I,null,{default:t(()=>[o(m,{cols:"12",md:"4"},{default:t(()=>[_[2]||(_[2]=d("div",{class:"text-overline mb-2"},"Leading Team",-1)),n.value.leadTeam?(a(),u(e,{key:0,variant:"tonal",color:"success"},{default:t(()=>[f(p(n.value.leadTeam),1)]),_:1})):(a(),g("span",ue,"Not assigned"))]),_:1,__:[2]}),o(m,{cols:"12",md:"4"},{default:t(()=>[_[3]||(_[3]=d("div",{class:"text-overline mb-2"},"Estimation",-1)),d("div",de,[n.value.estimation?(a(),u(e,{key:0,variant:"tonal",color:"info"},{default:t(()=>[f(p(n.value.estimation)+" pts ",1)]),_:1})):v("",!0),n.value.remainingEffort?(a(),u(e,{key:1,variant:"tonal",color:"warning"},{default:t(()=>[f(p(n.value.remainingEffort)+" remaining ",1)]),_:1})):v("",!0)])]),_:1,__:[3]}),o(m,{cols:"12",md:"4"},{default:t(()=>[_[5]||(_[5]=d("div",{class:"text-overline mb-2"},"Actions",-1)),o(z,{variant:"outlined",href:n.value.htmlUrl,target:"_blank",rel:"noopener noreferrer","prepend-icon":"mdi-open-in-new"},{default:t(()=>_[4]||(_[4]=[f(" View in Tuleap ")])),_:1,__:[4]},8,["href"])]),_:1,__:[5]})]),_:1}),o(w,{class:"my-4"}),n.value.summary?(a(),g("div",pe,[_[6]||(_[6]=d("div",{class:"text-overline mb-2"},"Summary",-1)),d("div",{class:"text-body-1 summary-content",innerHTML:n.value.summary},null,8,_e)])):v("",!0)]),_:1})]),_:1}),o(re,{epic:n.value},null,8,["epic"])],64)):v("",!0)]),_:1})}}}),ye=H(me,[["__scopeId","data-v-ad3668f1"]]);export{ye as default};
