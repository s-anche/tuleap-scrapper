import{S as P,d as tt,O as et,P as st,r as k,U as ot,k as b,x as w,z as f,I as _,J as T,B as n,C as s,g as c,y as r,D as y,A as m,L as at}from"./CTSJwtqj.js";import{_ as lt}from"./DlAUqK2U.js";const nt=()=>{const R=async u=>{const g=[];for(const d of u)try{const i=await P.getEpicTreeData(d);for(const p of i.features)for(const v of p.subArtifacts){const C=await S(v,p.artifact.id);g.push(C)}for(const p of i.directStories){const v=await S(p,d.id);g.push(v)}for(const p of i.directTasks){const v=await S(p,d.id);g.push(v)}}catch(i){console.error(`Error processing epic ${d.id}:`,i)}return g},S=async(u,g)=>{const d=u.tracker.label.toLowerCase();let i="task";return d.includes("story")||d.includes("stories")?i="story":(d.includes("defect")||d.includes("bug")||d.includes("issue"))&&(i="defect"),{id:u.id,parentId:g,title:u.title,status:u.status,points:P.extractPoints(u),sprint:await P.extractSprintInfo(u),type:i,htmlUrl:P.buildTuleapUrl(u.html_url,u.id)}};return{flattenEpicTreeData:R}},rt={class:"pa-4"},it={class:"d-flex align-center mb-4"},ct={class:"d-flex align-center ga-2"},ut={key:0,class:"text-caption"},dt={key:1,class:"text-caption text-grey"},pt={class:"d-flex align-center"},vt=["href"],mt={key:0,class:"font-weight-bold"},ft={key:1,class:"text-grey"},_t={key:1,class:"text-grey"},yt={class:"text-center pa-2"},gt=tt({__name:"stories-table",setup(R){const S=et(),{epics:u,loading:g}=st(S),{flattenEpicTreeData:d}=nt(),i=k(""),p=k(""),v=k(""),C=k(1),W=k(50),h=k([]),L=k(!1),A=[{title:"ID",value:"id",sortable:!0,width:"100px"},{title:"Parent ID",value:"parentId",sortable:!0,width:"100px"},{title:"Title",value:"title",sortable:!0},{title:"Status",value:"status",sortable:!0,width:"150px"},{title:"Points",value:"points",sortable:!0,width:"100px"},{title:"Sprint",value:"sprint",sortable:!0,width:"150px"}];ot(u,async o=>{if(o.length>0){L.value=!0;try{h.value=await d(o)}catch(t){console.error("Error flattening epic tree data:",t)}finally{L.value=!1}}else h.value=[]},{immediate:!0});const E=b(()=>g.value||L.value),M=b(()=>[...new Set(h.value.map(t=>t.status))].sort()),O=b(()=>[{title:"Story",value:"story"},{title:"Task",value:"task"},{title:"Defect",value:"defect"}]),x=b(()=>{let o=h.value;if(i.value){const t=i.value.toLowerCase();o=o.filter(a=>a.id.toString().includes(t)||a.title.toLowerCase().includes(t)||a.status.toLowerCase().includes(t)||a.sprint&&a.sprint.toLowerCase().includes(t))}return p.value&&(o=o.filter(t=>t.status===p.value)),v.value&&(o=o.filter(t=>t.type===v.value)),o.sort((t,a)=>!t.sprint&&!a.sprint?0:t.sprint?a.sprint?a.sprint.localeCompare(t.sprint):1:-1)}),V=b(()=>x.value.filter(a=>a.type==="story").filter(a=>a.points!==null&&a.points>=0)),j=b(()=>V.value.length),D=b(()=>V.value.reduce((t,a)=>t+(a.points||0),0)),B=b(()=>V.value.length===0?0:D.value/V.value.length),J=o=>{switch(o){case"story":return"mdi-book-open-variant";case"task":return"mdi-checkbox-marked-circle";case"defect":return"mdi-bug";default:return"mdi-circle"}},N=o=>{switch(o){case"story":return"blue";case"task":return"yellow";case"defect":return"red";default:return"grey"}},$=o=>{const t=o.toLowerCase();return t.includes("done")||t.includes("closed")?"success":t.includes("progress")||t.includes("development")?"warning":t.includes("cancel")?"error":t.includes("todo")||t.includes("new")?"info":"default"},q=async()=>{try{const o=["ID","Parent ID","Title","Status","Points","Sprint","Type","URL"],t=x.value.map(l=>[l.id,l.parentId||"",l.title,l.status,l.points||"",l.sprint||"",l.type,l.htmlUrl]),z=[o,...t].map(l=>l.join("	")).join(`
`);await navigator.clipboard.writeText(z)}catch(o){console.error("Failed to copy to clipboard:",o)}};return(o,t)=>{const a=c("v-icon"),z=c("v-spacer"),l=c("v-chip"),G=c("v-btn"),H=c("v-text-field"),U=c("v-col"),F=c("v-select"),K=c("v-row"),Q=c("v-card-text"),I=c("v-card"),X=c("v-pagination"),Y=c("v-data-table"),Z=c("v-progress-circular");return r(),w("div",rt,[f("div",it,[n(a,{class:"mr-2",size:"large"},{default:s(()=>t[5]||(t[5]=[y("mdi-table")])),_:1,__:[5]}),t[7]||(t[7]=f("h2",{class:"text-h4"},"Stories & Tasks",-1)),n(z),f("div",ct,[x.value.length>0?(r(),_(l,{key:0,color:"primary",variant:"tonal",size:"large",class:"text-subtitle-1"},{default:s(()=>[y(m(x.value.length)+" Item"+m(x.value.length>1?"s":""),1)]),_:1})):T("",!0),j.value>0&&B.value>0?(r(),_(l,{key:1,color:"info",variant:"tonal",size:"large",class:"text-subtitle-1"},{default:s(()=>[y(" Mean: "+m(B.value.toFixed(1))+" pts/story ",1)]),_:1})):T("",!0),D.value>0?(r(),_(l,{key:2,color:"success",variant:"tonal",size:"large",class:"text-subtitle-1"},{default:s(()=>[y(" Total: "+m(D.value)+" pts ",1)]),_:1})):T("",!0),h.value.length>0?(r(),_(G,{key:3,onClick:q,color:"primary",variant:"outlined",size:"small","prepend-icon":"mdi-content-copy"},{default:s(()=>t[6]||(t[6]=[y(" Copy to Excel ")])),_:1,__:[6]})):T("",!0)])]),h.value.length>0?(r(),_(I,{key:0,class:"mb-4"},{default:s(()=>[n(Q,null,{default:s(()=>[n(K,null,{default:s(()=>[n(U,{cols:"12",md:"6"},{default:s(()=>[n(H,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),label:"Search",placeholder:"Search by ID, title, or status...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue"])]),_:1}),n(U,{cols:"12",md:"3"},{default:s(()=>[n(F,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),label:"Status",items:M.value,variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1}),n(U,{cols:"12",md:"3"},{default:s(()=>[n(F,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),label:"Type",items:O.value,variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1})]),_:1})):T("",!0),h.value.length>0?(r(),_(I,{key:1},{default:s(()=>[n(Y,{headers:A,items:x.value,loading:E.value,"item-key":"id","show-select":"","disable-pagination":"",class:"elevation-1"},{"item.id":s(({item:e})=>[n(l,{color:N(e.type),variant:"tonal",size:"small",class:"font-weight-bold"},{default:s(()=>[y(m(e.id),1)]),_:2},1032,["color"])]),"item.parentId":s(({item:e})=>[e.parentId?(r(),w("span",ut,m(e.parentId),1)):(r(),w("span",dt,"—"))]),"item.title":s(({item:e})=>[f("div",pt,[n(a,{icon:J(e.type),color:N(e.type),size:"small",class:"mr-2"},null,8,["icon","color"]),f("a",{href:e.htmlUrl,target:"_blank",class:"text-decoration-none",onClick:t[3]||(t[3]=at(()=>{},["stop"]))},m(e.title),9,vt)])]),"item.status":s(({item:e})=>[n(l,{color:$(e.status),variant:"tonal",size:"small"},{default:s(()=>[y(m(e.status),1)]),_:2},1032,["color"])]),"item.points":s(({item:e})=>[e.points!==null?(r(),w("span",mt,m(e.points),1)):(r(),w("span",ft,"—"))]),"item.sprint":s(({item:e})=>[e.sprint?(r(),_(l,{key:0,color:"info",variant:"outlined",size:"small"},{default:s(()=>[y(m(e.sprint),1)]),_:2},1024)):(r(),w("span",_t,"—"))]),bottom:s(()=>[f("div",yt,[n(X,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=e=>C.value=e),length:Math.ceil(x.value.length/W.value),"total-visible":7},null,8,["modelValue","length"])])]),_:1},8,["items","loading"])]),_:1})):E.value?(r(),_(I,{key:2,class:"text-center pa-12"},{default:s(()=>[n(Z,{indeterminate:"",color:"primary",size:"64"}),t[8]||(t[8]=f("p",{class:"text-h6 mt-4"},"Loading stories and tasks...",-1))]),_:1,__:[8]})):(r(),_(I,{key:3,class:"text-center pa-12"},{default:s(()=>[n(a,{size:"64",color:"grey-lighten-2"},{default:s(()=>t[9]||(t[9]=[y("mdi-table-off")])),_:1,__:[9]}),t[10]||(t[10]=f("p",{class:"text-h6 mt-4"},"No stories or tasks found",-1)),t[11]||(t[11]=f("p",{class:"text-body-1"}," Load some epics from the sidebar to see their stories and tasks here. ",-1))]),_:1,__:[10,11]}))])}}}),xt=lt(gt,[["__scopeId","data-v-afa9ac3d"]]);export{xt as default};
